<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rifa CR4 - Gana la Moto de tus Sueños</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Librería de Confetti para efecto WOW -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>

    <!-- 
        ========================================================================
        1. CONFIGURACIÓN CRÍTICA DE FIREBASE (Realtime Database)
        ======================================================================== 
        Estas líneas cargan el SDK y lo inicializan con tu configuración.
        NOTA: Usamos el CDN de Firebase para Realtime Database (database.js)
    -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script>
        // ESTA ES LA CONFIGURACIÓN QUE ME PROPORCIONASTE
        const firebaseConfig = {
            apiKey: "AIzaSyBshc3BQDbSa1ZALyTo8dlSIOWlK9el1fw",
            authDomain: "rifacr4-rtrifacr4-rt.firebaseapp.com",
            databaseURL: "https://rifacr4-rtrifacr4-rt-default-rtdb.firebaseio.com", // Asegúrate que esta URL sea correcta si no la proporcionaste
            projectId: "rifacr4-rtrifacr4-rt",
            storageBucket: "rifacr4-rtrifacr4-rt.firebasestorage.app",
            messagingSenderId: "236053694074",
            appId: "1:236053694074:web:76aa18fe73b51bb4ea1dc3",
            measurementId: "G-VZRXGRDRYJ"
        };
        
        // Inicializar Firebase y obtener la referencia a la base de datos
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>
</head>
<body>

    <!-- PANTALLA DE CARGA (SPLASH SCREEN) -->
    <div id="splash-screen" class="splash-screen">
        <div class="intro-content">
            <i class="fas fa-motorcycle intro-icon pulse"></i>
            <h1 class="neon-glow-red">RIFA CR4</h1>
            <p>Cargando disponibilidad de boletas en tiempo real...</p>
        </div>
    </div>

    <!-- CONTENIDO PRINCIPAL DE LA APLICACIÓN -->
    <main id="app-content" class="hidden">
        
        <!-- HEADER Y NAVEGACIÓN -->
        <header class="main-header">
            <nav class="nav-bar glass-box">
                <span class="logo-text">CR4</span>
                <div class="nav-buttons">
                    <button id="btn-admin" class="btn-nav"><i class="fas fa-user-lock"></i> Admin</button>
                    <button id="btn-ganadores" class="btn-nav"><i class="fas fa-trophy"></i> Historial</button>
                </div>
            </nav>
        </header>

        <!-- BANNER E INFORMACIÓN PRINCIPAL -->
        <section class="hero-banner fade-in">
            <img src="Rifa.jpg" alt="Imagen de la Moto Honda CR4 de la Rifa" class="banner-img">
            <div class="game-details glass-box slide-up">
                <h2>¡Gana la increíble CR4!</h2>
                <p class="price neon-glow-green">$25.000 COP / Boleta</p>
                <p>Fecha Sorteo Principal: <span class="highlight-text">Enero 30, 2026</span></p>
            </div>
        </section>

        <!-- CONTADORES Y ESTADÍSTICAS -->
        <section class="dashboard-stats glass-box slide-up" style="animation-delay: 1.8s;">
            <h3>Tiempo Restante</h3>
            <div class="timers-grid">
                <div class="timer-box">
                    <p>Sorteo Final</p>
                    <div id="timer-final" class="countdown-timer neon-glow-red"></div>
                </div>
                <div class="timer-box">
                    <p>Próximo Semanal</p>
                    <div id="timer-semanal" class="countdown-timer neon-glow-green"></div>
                </div>
            </div>

            <h3 style="margin-top: 20px;">Estado de la Rifa (Real-Time)</h3>
            <div class="stats-grid">
                <div class="stat-item libre">
                    <p id="stat-libre">0</p>
                    <span>Libres</span>
                </div>
                <div class="stat-item reservado">
                    <p id="stat-reservado">0</p>
                    <span>Reservadas</span>
                </div>
                <div class="stat-item pagado">
                    <p id="stat-pagado">0</p>
                    <span>Pagadas</span>
                </div>
                <div class="stat-item total">
                    <p>1000</p>
                    <span>Total</span>
                </div>
            </div>
        </section>

        <!-- SELECTOR DE BOLETAS -->
        <section class="boletas-selection-section slide-up" style="animation-delay: 2.1s;">
            <div class="glass-box">
                <h3>Selecciona tus Números (000 al 999)</h3>
                <p class="leyenda-container">
                    <span class="badge disponible"><i class="fas fa-circle"></i> Libre</span>
                    <span class="badge reservado"><i class="fas fa-circle"></i> Reservado</span>
                    <span class="badge pagado"><i class="fas fa-circle"></i> Pagado</span>
                </p>

                <div class="search-filter-bar">
                    <input type="text" id="search-number" placeholder="Buscar número (ej: 123)">
                    <select id="filter-status">
                        <option value="todos">Mostrar Todos</option>
                        <option value="libre">Disponibles</option>
                        <option value="reservado">Reservados</option>
                        <option value="pagado">Pagados</option>
                    </select>
                </div>
                
                <div id="grid-boletas" class="grid-container">
                    <!-- Las boletas se generan aquí por script.js -->
                </div>
            </div>
        </section>

        <!-- REGLAS Y PREGUNTAS FRECUENTES -->
        <section class="rules-faq-section slide-up" style="animation-delay: 2.4s;">
            <h2>Reglas y Premios</h2>
            <div class="glass-box">
                <details>
                    <summary>¿Cuál es el premio principal?</summary>
                    <p>El premio principal es una espectacular motocicleta Honda CR4 nueva, con todos los papeles al día y SOAT incluido. ¡Lista para rodar!</p>
                </details>
                <details>
                    <summary>¿Cómo sé que la boleta está reservada?</summary>
                    <p>Una vez que completas el formulario y envías el mensaje por WhatsApp, la boleta cambia a estado **RESERVADO** (Amarillo) por un plazo de 2 horas. Si no se confirma el pago en ese tiempo, la boleta se libera automáticamente.</p>
                </details>
                <details>
                    <summary>¿Cuántos sorteos hay?</summary>
                    <p>Tenemos sorteos semanales con premios en efectivo (o premios sorpresa) y el Sorteo Final de la moto CR4. Todos los números comprados participan en todos los sorteos hasta la fecha final.</p>
                </details>
                <details>
                    <summary>Métodos de Pago</summary>
                    <p>Aceptamos Nequi, Daviplata, transferencia Bancolombia y pagos en efectivo (contacta al administrador para detalles).</p>
                </details>
            </div>
        </section>

        <!-- PIE DE PÁGINA -->
        <footer>
            <p>&copy; 2025 Rifa CR4. Desarrollado con Firebase Real-Time.</p>
        </footer>
    </main>

    <!-- FOOTER STICKY PARA COMPRA -->
    <div id="sticky-form-buy" class="sticky-footer hidden">
        <div class="buy-panel">
            <div class="total-info">
                <span class="total-text">Total a Pagar <span id="num-seleccionados-count"></span>:</span>
                <span id="total-price" class="neon-glow-red"></span>
            </div>
            <button id="btn-participar-main" class="btn-confirm pulse"><i class="fab fa-whatsapp"></i> Participar Ahora</button>
        </div>
    </div>

    <!-- MODAL 1: CONFIRMACIÓN DEL CLIENTE (Formulario de Reserva) -->
    <div id="modal-cliente-confirm" class="modal hidden">
        <div class="modal-content glass-box">
            <button class="btn-close" onclick="toggleModal('modal-cliente-confirm', false);">&times;</button>
            <h2 class="neon-glow-green">Confirma tu Reserva</h2>
            <p>Estás a punto de reservar los números: <strong id="client-modal-numbers" class="highlight-text"></strong></p>
            <p class="small-text">Diligencia tus datos para que podamos contactarte y confirmar tu pago. Tu reserva dura 2 horas.</p>

            <form id="client-confirm-form">
                <label for="client-name">Nombre Completo:</label>
                <input type="text" id="client-name" required placeholder="Ej: Juan Pérez">

                <label for="client-phone">Teléfono de Contacto (WhatsApp):</label>
                <input type="tel" id="client-phone" required placeholder="Ej: 3219876543">

                <button type="submit" class="btn-confirm-whatsapp"><i class="fab fa-whatsapp"></i> RESERVAR Y ENVIAR WHATSAPP</button>
            </form>
        </div>
    </div>

    <!-- MODAL 2: PANEL DE ADMINISTRACIÓN -->
    <div id="modal-admin-panel" class="modal hidden">
        <div class="modal-content glass-box admin-size">
            <button class="btn-close" onclick="toggleModal('modal-admin-panel', false);">&times;</button>
            <h2 class="neon-glow-red">Panel de Administración</h2>
            <p>Gestión de boletas en tiempo real.</p>

            <div class="admin-actions-grid">
                <button id="btn-assign-manual" class="btn-admin-action"><i class="fas fa-edit"></i> Asignar Manual</button>
                <button id="btn-manage-sorteos" class="btn-admin-action"><i class="fas fa-trophy"></i> Registrar Ganador</button>
                <button id="btn-download-data" class="btn-admin-action"><i class="fas fa-download"></i> Exportar CSV</button>
                <button id="btn-reset-data" class="btn-admin-action btn-danger"><i class="fas fa-eraser"></i> RESET TOTAL</button>
            </div>

            <h3>Boletas Reservadas (<span id="count-reservadas">0</span>)</h3>
            <div class="admin-data-summary glass-box">
                <table id="table-reservadas" class="admin-table">
                    <!-- Contenido generado por admin.js -->
                </table>
            </div>

            <h3>Boletas Pagadas (<span id="count-pagadas">0</span>)</h3>
            <div class="admin-data-summary glass-box">
                <table id="table-pagadas" class="admin-table">
                    <!-- Contenido generado por admin.js -->
                </table>
            </div>
        </div>
    </div>
    
    <!-- MODAL 3: ASIGNACIÓN MANUAL -->
    <div id="modal-assign-manual" class="modal hidden">
        <div class="modal-content glass-box">
            <button class="btn-close" onclick="toggleModal('modal-assign-manual', false); toggleModal('modal-admin-panel', true);">&times;</button>
            <h2 class="neon-glow-green">Asignación Directa</h2>
            <p>Asigna una boleta de forma rápida, sin pasar por WhatsApp.</p>
            <form id="form-assign-manual">
                <label for="manual-num">Número de Boleta (000-999):</label>
                <input type="number" id="manual-num" min="0" max="999" required placeholder="Ej: 045">

                <label for="manual-name">Nombre del Cliente:</label>
                <input type="text" id="manual-name" required placeholder="Ej: Pedro Gonzales">

                <label for="manual-phone">Teléfono:</label>
                <input type="tel" id="manual-phone" required placeholder="Ej: 3001234567">
                
                <div class="admin-actions-grid" style="grid-template-columns: 1fr 1fr; margin-top: 15px;">
                    <button type="button" class="btn-confirm btn-pagar-manual">Marcar como PAGADO</button>
                    <button type="button" class="btn-admin-action btn-reservar-manual">Marcar como RESERVADO</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- MODAL 4: REGISTRO DE GANADORES -->
    <div id="modal-register-winner" class="modal hidden">
        <div class="modal-content glass-box">
            <button class="btn-close" onclick="toggleModal('modal-register-winner', false); toggleModal('modal-admin-panel', true);">&times;</button>
            <h2 class="neon-glow-red">Registro de Sorteo</h2>
            <p>Registra el resultado de un sorteo semanal o final.</p>
            <form id="form-register-winner">
                <label for="winner-date">Fecha del Sorteo:</label>
                <input type="date" id="winner-date" required value="2025-12-02">

                <label for="winner-lottery">Lotería / Sorteo:</label>
                <input type="text" id="winner-lottery" required placeholder="Ej: Lotería de Medellín">
                
                <label for="winner-number">Número Ganador (000-999):</label>
                <input type="number" id="winner-number" min="0" max="999" required placeholder="Ej: 456">
                
                <button type="submit" class="btn-confirm-whatsapp"><i class="fas fa-crown"></i> REGISTRAR GANADOR</button>
            </form>
        </div>
    </div>

    <!-- MODAL 5: HISTORIAL DE GANADORES -->
    <div id="modal-sorteo-history" class="modal hidden">
        <div class="modal-content glass-box admin-size">
            <button class="btn-close" onclick="toggleModal('modal-sorteo-history', false);">&times;</button>
            <h2 class="neon-glow-green">Historial de Sorteos</h2>
            <p>Ganadores anteriores registrados.</p>
            
            <div class="admin-data-summary glass-box" style="max-height: 500px;">
                <table id="table-winner-history" class="admin-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Lotería</th>
                            <th>Número</th>
                            <th>Estado Cliente</th>
                        </tr>
                    </thead>
                    <tbody id="table-winner-history-body">
                        <!-- Historial generado por admin.js -->
                        <tr><td colspan="4">Cargando historial...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>


    <!-- 2. ENLACE A SCRIPTS DE LÓGICA -->
    <script src="script.js"></script>
    <script src="admin.js"></script>
</body>
</html>
